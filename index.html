<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>World Explorer Quiz</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="app" class="container">
      <header class="topbar glass">
        <div class="logo">
          <img src="assets/icons/globe.svg" alt="logo" />
          <h1>World Explorer Quiz</h1>
        </div>
        <div class="controls">
          <button id="playBtn" class="btn amber">Play</button>
          <button id="restartBtn" class="btn" hidden>Play Again</button>
        </div>
      </header>

      <main class="main grid">
        <section class="left glass" id="streetviewPane">
          <div id="streetview" class="sv"></div>
          <div id="loading" class="loading hidden">Loading location...</div>
        </section>

        <section class="right glass" id="mapPane">
          <div id="map" class="map"></div>
          <div id="mapOverlay" class="map-overlay hidden">Map tiles not loaded yet. Click "Run Diagnostics" or check your API key.</div>
        </section>
      </main>

      <footer class="bottom glass">
        <div class="scoreboard">
          <div>Round <span id="roundNum">0</span>/5</div>
          <div>Score: <span id="totalScore">0</span></div>
        </div>
        <div class="actions">
          <button id="submitBtn" class="btn amber" disabled>Submit Guess</button>
          <button id="nextBtn" class="btn" disabled>Next Round</button>
        </div>
      </footer>

      <div id="overlay" class="overlay hidden">
        <div class="modal glass" id="summary">
          <h2 id="summaryTitle">Round Result</h2>
          <div id="summaryContent"></div>
          <div class="modalActions">
            <button id="closeSummary" class="btn">Close</button>
          </div>
        </div>
      </div>
    </div>

    <script src="config.js"></script>
    <!-- Load Google Maps JS API ASAP using the key in config.js -->
    <script>
      (function(){
        try{
          const hint = () => document.getElementById('apiHint');
          if (typeof GOOGLE_MAPS_API_KEY === 'string' && GOOGLE_MAPS_API_KEY.length>8) {
            const s = document.createElement('script');
            // use callback so we can initialize MapHandler when API is ready
            // follow Google recommended loading pattern: include loading=async
            s.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_MAPS_API_KEY}&libraries=places&v=weekly&callback=initMapHandler&loading=async`;
            s.async = true;
            s.defer = true;
            // also set loading attribute (some browsers / validators use this)
            try{ s.setAttribute('loading','async'); }catch(e){}
            s.onerror = (ev) => {
              window.__mapsScriptError = ev || { message: 'Script load error' };
              const el = hint(); if (el) { el.classList.remove('hidden'); el.textContent = 'Failed to load Google Maps JS. Check network and API key.'; }
            };
            document.head.appendChild(s);
          } else {
            const el = hint(); if (el) el.classList.remove('hidden');
            console.warn('Google Maps API key missing or too short. Add it to config.js');
          }
        }catch(e){console.error(e)}
      })();
    </script>

    <!-- App scripts (deferred) -->
    <script src="mapHandler.js" defer></script>
    <script src="streetviewHandler.js" defer></script>
    <script src="script.js" defer></script>
    <!-- Diagnostics and hints removed for production deploy -->
  </body>
</html>
